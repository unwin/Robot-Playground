/*
 * test_gps.cpp
 *
 *  Created on: Dec 11, 2012
 *      Author: unwin
 */


// test_gps.cpp

#define BOOST_TEST_DYN_LINK
#define BOOST_TEST_MODULE Main
#include <iostream>
#include <ostream>
#include <string>
#include <boost/test/unit_test.hpp>
#include "../serial/GPS.hpp"
#include "../log.h"
#include <boost/thread/thread.hpp>

using namespace std;




string test_data[] = {
	"$GPGGA,050231.000,3259.3649,N,11703.4700,W,2,07,1.2,124.0,M,,,0.8,0000*3C",
	"$GPGSA,A,3,23,13,16,20,32,30,07,,,,,,3.1,1.2,2.8*3A",
	"$GPGSV,3,1,12,23,63,353,41,20,62,196,37,16,57,102,29,30,42,056,33*7B",
	"$GPGSV,3,2,12,32,42,157,30,13,38,312,33,07,24,249,30,04,09,295,21*78",
	"$GPGSV,3,3,12,03,09,137,19,31,08,052,23,06,08,117,28,01,03,199,*71",
	"$GPRMC,050231.000,A,3259.3649,N,11703.4700,W,0.07,,121212,,*0C",
	"$GPGGA,050238.000,3259.3647,N,11703.4700,W,2,07,1.2,124.0,M,,,1.8,0000*3A",
	"$GPGSA,A,3,23,13,16,20,32,30,07,,,,,,3.1,1.2,2.8*3A",
	"$GPGSV,3,1,12,23,63,353,40,20,62,196,37,16,57,102,30,30,42,056,33*72",
	"$GPGSV,3,2,12,32,42,157,30,13,38,312,33,07,24,249,30,04,09,295,19*73",
	"$GPGSV,3,3,12,03,09,137,17,31,08,052,22,06,08,117,28,01,03,199,*7E",
	"$GPRMC,050238.000,A,3259.3647,N,11703.4700,W,0.21,,121212,,*0F",
	"$GPGGA,050316.000,3259.3642,N,11703.4705,W,2,08,1.1,124.0,M,,,2.8,0000*38",
	"$GPGSA,A,3,23,13,16,20,06,32,30,07,,,,,1.9,1.1,1.5*3B",
	"$GPGSV,3,1,12,23,63,354,40,20,61,195,36,16,57,101,29,30,42,056,33*7F",
	"$GPGSV,3,2,12,32,41,158,30,13,38,313,35,07,25,250,28,03,09,136,19*75",
	"$GPGSV,3,3,12,04,09,295,21,06,08,116,27,31,08,052,21,10,04,321,*7C",
	"$GPRMC,050316.000,A,3259.3642,N,11703.4705,W,0.14,,121212,,*04",
	"$GPGSV,3,2,12,32,41,158,30,13,38,313,36,07,25,250,28,03,09,136,20*7C",
	"$GPGSV,3,3,12,04,09,295,20,06,08,116,27,31,08,052,21,10,04,321,*7D",
	"$GPRMC,050325.000,A,3259.3642,N,11703.4706,W,0.17,,121212,,*04",
	"$GPGGA,050326.000,3259.3642,N,11703.4706,W,2,08,1.1,124.0,M,,,1.8,0000*3B",
	"$GPGSA,A,3,23,13,16,20,06,32,30,07,,,,,1.9,1.1,1.5*3B",
	"$GPGSV,3,1,12,23,63,354,40,20,61,195,36,16,57,101,29,30,42,056,32*7E",
	"$GPGSV,3,2,12,32,41,158,30,13,38,313,35,07,25,250,28,03,09,136,20*7F",
	"$GPGSV,3,3,12,04,09,295,20,06,08,116,27,31,08,052,21,10,04,321,*7D",
	"$GPRMC,050326.000,A,3259.3642,N,11703.4706,W,0.15,,121212,,*05",
	"$GPGSV,3,1,12,23,64,356,39,20,60,194,35,16,58,098,28,30,41,054,32*78",
	"$GPGSV,3,2,12,32,40,158,19,13,39,314,34,07,26,251,33,03,10,135,27*76",
	"$GPGSV,3,3,12,06,09,115,22,04,09,294,21,31,07,053,19,10,05,321,*7E",
	"$GPRMC,050621.000,A,3259.3638,N,11703.4698,W,0.20,,121212,,*0A",
	"$GPGGA,050622.000,3259.3638,N,11703.4698,W,2,09,0.9,124.0,M,,,2.8,0000*3A",
	"$GPGSA,A,3,23,13,31,16,20,06,32,30,07,,,,1.6,0.9,1.3*39",
	"$GPGSV,3,1,12,23,64,356,39,20,60,194,35,16,58,098,28,30,41,054,32*78",
	"$GPGSV,3,2,12,32,40,158,19,13,39,314,34,07,26,251,33,03,10,135,27*76",
	"$GPGSV,3,3,12,06,09,115,22,04,09,294,21,31,07,053,19,10,05,321,*7E",
	"$GPRMC,050622.000,A,3259.3638,N,11703.4698,W,0.09,,121212,,*02"
};

BOOST_AUTO_TEST_SUITE(test_gps_suite)

BOOST_AUTO_TEST_CASE(test_gps_parsers) {

	GPS gps = GPS();
	for (int index = 0; index < 37; index++) {
		LOG << "TEST LINE " << index << " = " << test_data[index];
		gps.process_line(test_data[index]);
	}
}

BOOST_AUTO_TEST_CASE(test_gps_read) {

	GPS gps = GPS("/dev/ttyAMA0", 9600);
	for (;;) {
		gps.report();
		boost::this_thread::sleep(boost::posix_time::seconds(60));
	}


}


BOOST_AUTO_TEST_SUITE_END()


